name: express-react

secrets:

  root-user:
    file: ./database/secrets/root_user.txt

  root-pass:
    file: ./database/secrets/root_pass.txt

  db-user:
    file: ./database/secrets/db_user.txt

  db-pass:
    file: ./database/secrets/db_pass.txt


volumes:

  express-react-db:
    external: false

  express-react-certificates:
    external: false


services:

  database:
    image: mongo:8.2.3-noble
    container_name: express-react-database
    hostname: express-react-database
    init: true
    volumes:
      - express-react-db:/data/db
    secrets:
      - root-user
      - root-pass
    # environment:
    #   MONGO_INITDB_ROOT_USERNAME_FILE: /run/secrets/root-user
    #   MONGO_INITDB_ROOT_PASSWORD_FILE: /run/secrets/root-pass

  backend:
    depends_on:
      - database
    image: express-react-backend
    build: ./backend
    container_name: express-react-backend
    hostname: express-react-backend
    init: true
    secrets:
      - db-user
      - db-pass
    environment:
      DB_USER_NAME_FILE: /run/secrets/db-user
      DB_USER_PASS_FILE: /run/secrets/db-pass
    ports:
      - 3000:3000
